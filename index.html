<html>
    <head>
        <style>
            * {
                font-size: 110%;
            }
        </style>
        <title>Shock collar control</title>
    </head>
    <body>
        <h1>Shock Collar control</h1>
        <form id="form">
            <label for="mode">Mode</label>
            <select name="mode" id="mode">
                <option value="beep" selected>Beep</option>
                <option value="vibrate">Vibrate</option>
                <option value="shock">Shock</option>
            </select>
            <br>
            <label for="level">Level (limited by server to 5 (of 100))</label>
            <input name="level" id="level" type="range" min="1" max="5" step="1" value="1"><output id="level-out">1</output>
            <br>
            <button id="submit" type="submit">Send ðŸ”Š</button>
        </form>
        <script>
            const form = document.getElementById('form');
            const levelInput = document.getElementById('level');
            const modeInput = document.getElementById('mode');
            const levelOutput = document.getElementById('level-out');
            const submit = document.getElementById('submit');
            const password = prompt('Password please :3 (checked by server when pressing button)');
            const user = prompt('Please enter a username (not saved or anything') || 'anon';
            const icons = {
                beep: 'ðŸ”Š',
                shock: 'âš¡',
                vibrate: 'ðŸ“³'
            }
            function setInputLock(locked) {
                Array.from(form.querySelectorAll('input,select,button')).forEach(e => {
                    e.disabled = locked;
                });
            }
            function updateSend() {
                const mean = levelInput.valueAsNumber >= 20 && modeInput.value === 'shock';
                submit.innerText = `Send ${icons[modeInput.value]} ${mean ? '>:3' : ''}`;
            }
            levelInput.addEventListener('input', ev => {
                levelOutput.value = levelInput.value;
                updateSend();
            });
            modeInput.addEventListener('change', updateSend);
            form.addEventListener('submit', ev => {
                ev.preventDefault();
                setInputLock(true);
                Promise.all([
                    new Promise(res => setTimeout(res, 2500)),
                    fetch('/', {
                        method: 'post',
                        headers: new Headers({
                            authorization: `Bearer ${password}`,
                            'x-user': user,
                        }),
                        body: `${modeInput.value},${levelInput.value}`,
                    })
                    .then(r => {
                        if (r.status === 401) {
                            setInputLock(true);
                            alert('Wrong password, please reload and enter again (I am lazy).');
                            throw new Error('disabled :3');
                        }
                    })
                ])
                .then(() => {
                    setInputLock(false);
                })
            })
        </script>
    </body>
</html>